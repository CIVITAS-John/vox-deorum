name: Build Installer

on:
  workflow_dispatch:

jobs:
  build-installer:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Install Inno Setup
        run: |
          Write-Host "Downloading Inno Setup 6..."
          $installerPath = "$env:TEMP\innosetup.exe"
          Invoke-WebRequest -Uri "https://jrsoftware.org/download.php/is.exe" -OutFile $installerPath

          Write-Host "Installing Inno Setup 6 silently..."
          Start-Process -FilePath $installerPath -ArgumentList "/VERYSILENT", "/SUPPRESSMSGBOXES", "/NORESTART", "/SP-" -Wait

          Write-Host "Inno Setup installed successfully"

      - name: Build installer using build-installer.cmd
        shell: cmd
        run: |
          echo Running build-installer.cmd script...
          cd scripts
          call build-installer.cmd
          echo Build script completed with exit code: %ERRORLEVEL%
          exit /b %ERRORLEVEL%

      - name: Verify installer was created
        run: |
          $version = "${{ github.event.inputs.release_version }}"
          $installerPath = "dist\VoxDeorum-$version.exe"

          if (Test-Path $installerPath) {
              Write-Host "Installer successfully created at: $installerPath"
          } else {
              Write-Error "Installer file not found at expected path: $installerPath"
              exit 1
          